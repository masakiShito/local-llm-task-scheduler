【ファイル名】docs/詳細設計/08*テスト設計/01*テスト観点一覧.md

# 詳細設計：テスト観点一覧（MVP）

## 1. 本書の目的

本書は、本システムの MVP において実施すべきテスト観点を一覧化し、
「何をテストするか」「どこまで担保するか」を明確にすることを目的とする。

以降のテストケース設計・自動テスト実装は、本観点を前提とする。

---

## 2. テスト対象と優先度

### 2.1 優先度定義

| 優先度 | 定義                           |
| ------ | ------------------------------ |
| P0     | 不具合があると機能が成立しない |
| P1     | 品質低下・UX 悪化につながる    |
| P2     | 回帰防止・安定性向上           |

---

## 3. スケジューラ テスト観点

### 3.1 P0（必須）

- working_hours から events を差し引き、正しい空き時間スロットが生成される
- event が部分重複した場合、重複部分のみが差し引かれる
- event により空き時間が分割される
- 5 分未満のスロットが破棄される
- status=open のタスクのみが対象となる
- due_at 昇順でタスクが並ぶ（決定論）
- 割当しきれないタスクが overflow になる（not_enough_free_time）

### 3.2 P1（重要）

- splittable=false のタスクが連続枠不足で overflow になる
- splittable=true のタスクが min_block_minutes 単位で分割される
- focus_max_minutes を超えない位置に break が挿入される
- break が確保できない場合 warnings（W-0210）が付与される
- buffer_ratio に基づき buffer が確保される
- buffer を確保できない場合 warnings（W-0211）が付与される
- 当日期限タスクが overflow の場合 warnings（W-0202）が付与される

### 3.3 P2（任意）

- working_hours が未ソートでも結果が同一
- events が未ソートでも結果が同一
- tasks 入力順が異なっても結果が同一

---

## 4. API テスト観点

### 4.1 共通（P0）

- 正常系で想定 HTTP ステータスが返る
- 入力エラー時に 400 + message_id=E-0400 が返る
- field_errors に正しい field 名が含まれる
- 対象なし時に 404 + message_id=E-0404 が返る
- サーバエラー時に 500 + message_id=E-0500 が返る
- 成功時に meta.message_id が返る

---

### 4.2 Task API

#### P0

- 必須項目のみで作成できる
- title 未入力で 400
- priority 範囲外で 400
- estimate_minutes 範囲外で 400
- splittable=true かつ min_block_minutes 未指定で 400

#### P1

- 更新対象が存在しない場合 404
- 削除後に再取得すると 404

---

### 4.3 Event API

#### P0

- 正常に固定予定を作成できる
- start_at >= end_at で 400
- title 未入力で 400

#### P1

- 対象日イベントが 0 件でも正常に取得できる

---

### 4.4 Plan / PlansGenerate API

#### P0

- open タスクが 0 件でも計画生成できる
- 空き時間が 0 でも 200 + overflow + warnings が返る
- working_hours 未指定で 400
- working_hours が重複・交差している場合 400

#### P1

- overflow 発生時に warnings（W-0201）が返る
- LLM 失敗時に summary=null + warnings（W-0203）が返る

---

## 5. DB 制約 テスト観点

### 5.1 P0

- plan 削除時に plan_blocks が CASCADE 削除される
- task 削除時に plan_blocks.task_id が null になる
- 存在しない plan_id を参照した plan_block が INSERT できない

### 5.2 P1

- CHECK 制約違反（priority / estimate_minutes / kind）で INSERT が失敗する
- start_at >= end_at の plan_block が INSERT できない

---

## 6. 非機能観点（最低限）

### P1

- 同一入力で plans/generate の結果が毎回同一
- 想定件数（タスク 50 件程度）でタイムアウトしない

---

## 7. 備考

- 本観点は MVP 基準であり、Phase2 以降で拡張する
- 本一覧をベースにテストケース表・自動テストを作成する
