# 詳細設計：画面項目定義（計画）

## 1. 対象画面

- SCR-400 計画一覧
- SCR-401 計画生成（条件入力）
- SCR-402 計画詳細（タイムライン）
- SCR-403 overflow / warnings 詳細

## 2. データ項目（Plan / PlanBlock / Summary）

### 2.1 Plan

| 項目         | キー     | 型           | 備考                         |
| ------------ | -------- | ------------ | ---------------------------- |
| 計画 ID      | plan_id  | string(UUID) |                              |
| 対象日       | date     | date         | YYYY-MM-DD                   |
| タイムゾーン | timezone | string       | 既定 Asia/Tokyo              |
| 生成条件     | params   | object       | working_hours/constraints 等 |
| 説明         | summary  | object/null  | LLM 生成の JSON              |

### 2.2 PlanBlock

| 項目        | キー     | 型                      | 備考           |
| ----------- | -------- | ----------------------- | -------------- |
| ブロック ID | block_id | string(UUID)            |                |
| 開始        | start_at | datetime                | ISO8601        |
| 終了        | end_at   | datetime                | ISO8601        |
| 種別        | kind     | enum(work/break/buffer) |                |
| タスク ID   | task_id  | string(UUID)/null       | work のみ      |
| メタ        | meta     | object                  | 理由・スコア等 |

### 2.3 Summary（LLM）

| 項目        | キー           | 型       | 備考                  |
| ----------- | -------------- | -------- | --------------------- |
| 概要        | summary        | string   |                       |
| 並び順理由  | why_this_order | string[] |                       |
| 警告        | warnings       | string[] |                       |
| overflow 案 | overflow_plan  | array    | taskTitle/suggestions |

## 3. 画面仕様

### 3.1 SCR-400 計画一覧

#### 3.1.1 画面要素

- Primary「計画を生成」
- 一覧（date 昇順 or 降順）
- 行操作：詳細

#### 3.1.2 操作と API

| 操作       | トリガー   | API        | 成功時     | 失敗時         |
| ---------- | ---------- | ---------- | ---------- | -------------- |
| 一覧取得   | 画面表示   | GET /plans | 一覧表示   | 画面上部エラー |
| 生成へ遷移 | 生成ボタン | -          | SCR-401 へ | -              |
| 詳細へ遷移 | 行クリック | -          | SCR-402 へ | -              |

---

### 3.2 SCR-401 計画生成（条件入力）

#### 3.2.1 入力項目（MVP）

| 表示名         | キー              | 型        | 必須 | 初期値      | 制約        |
| -------------- | ----------------- | --------- | ---- | ----------- | ----------- |
| 対象日         | date              | date      | 必須 | 今日        |             |
| 作業可能時間 1 | working_hours[0]  | start/end | 必須 | 09:00-12:00 | start < end |
| 作業可能時間 2 | working_hours[1]  | start/end | 任意 | 13:00-18:00 | start < end |
| 休憩（分）     | break_minutes     | int       | 任意 | 10          | 0〜30       |
| 集中上限（分） | focus_max_minutes | int       | 任意 | 90          | 30〜180     |
| バッファ比率   | buffer_ratio      | number    | 任意 | 0.10        | 0.00〜0.30  |

#### 3.2.2 画面操作

| 操作       | トリガー          | API                  | 成功時                    | 失敗時                           |
| ---------- | ----------------- | -------------------- | ------------------------- | -------------------------------- |
| 生成       | 生成（Primary）   | POST /plans/generate | SCR-402 へ遷移（plan_id） | field_errors 表示/画面上部エラー |
| キャンセル | 戻る（Secondary） | -                    | SCR-400 へ                | -                                |

#### 3.2.3 UI バリデーション（クライアント側）

- working_hours の重複/交差を禁止
- focus_max_minutes >= min_block_minutes（min_block がある場合）
- buffer_ratio は小数 2 桁まで入力可（表示は%でも可）

---

### 3.3 SCR-402 計画詳細（タイムライン）

#### 3.3.1 表示要素

- ヘッダ情報：date、作業可能時間、制約パラメータ（折りたたみ可）
- タイムライン：PlanBlock（work/break/buffer）
- サマリ：LLM summary（存在する場合のみ）
- 導線：overflow/warnings 詳細（SCR-403）

#### 3.3.2 操作と API

| 操作             | トリガー | API                         | 成功時              | 失敗時         |
| ---------------- | -------- | --------------------------- | ------------------- | -------------- |
| 取得（計画）     | 画面表示 | GET /plans/{plan_id}        | ヘッダ/summary 表示 | 404 は一覧導線 |
| 取得（ブロック） | 画面表示 | GET /plans/{plan_id}/blocks | タイムライン表示    | エラー表示     |

#### 3.3.3 表示ルール（要点）

- kind=work：タスクタイトルを表示（task_id から解決、または API が taskTitle を同梱）
- kind=break：休憩として表示
- kind=buffer：バッファとして表示
- warnings / overflow は専用セクションで表示（色は画面標準仕様）

---

### 3.4 SCR-403 overflow / warnings 詳細

#### 3.4.1 表示要素

- warnings：箇条書き
- overflow：タスク一覧（title / estimate / due_at / reason）
- overflow_plan（summary 内）：提案があれば表示

#### 3.4.2 操作と API

| 操作             | トリガー | API                         | 成功時                         | 失敗時     |
| ---------------- | -------- | --------------------------- | ------------------------------ | ---------- |
| 取得             | 画面表示 | GET /plans/{plan_id}        | warnings/overflow/summary 表示 | エラー表示 |
| 取得（ブロック） | 必要時   | GET /plans/{plan_id}/blocks | 参照用                         | エラー表示 |

## 4. UI エラー表示ルール（計画系）

- overflow / warnings / LLM 失敗は「エラー」ではなく「注意」として表示する（200 で返る）
- LLM 失敗は warnings に含め、画面上部に赤表示はしない
