# 詳細設計：画面項目定義（タスク）

## 1. 対象画面

- SCR-200 タスク一覧
- SCR-201 タスク詳細
- SCR-202 タスク作成
- SCR-203 タスク編集

## 2. データ項目（Task）

| 項目               | キー              | 型                       | 必須 | 備考                               |
| ------------------ | ----------------- | ------------------------ | ---- | ---------------------------------- |
| タイトル           | title             | string                   | 必須 | 最大 100 文字                      |
| 説明               | description       | string                   | 任意 | 最大 2000 文字                     |
| 種別               | type              | enum(todo/task)          | 必須 | UI はラジオまたはセレクト          |
| ステータス         | status            | enum(open/done/archived) | 必須 | 一覧では open/done を主表示        |
| 優先度             | priority          | int                      | 必須 | 1〜5（5 が最優先）                 |
| 想定工数（分）     | estimate_minutes  | int                      | 必須 | 5〜1440                            |
| 締切               | due_at            | datetime                 | 任意 | ISO8601（オフセット付き）          |
| 開始可能           | available_from    | datetime                 | 任意 | ISO8601（オフセット付き）          |
| 終了制限           | available_to      | datetime                 | 任意 | ISO8601（オフセット付き）          |
| 分割可否           | splittable        | bool                     | 任意 | 既定 true                          |
| 最小ブロック（分） | min_block_minutes | int                      | 任意 | 5〜180、splittable=true 時のみ有効 |
| タグ               | tags              | string[]                 | 任意 | 既定[]                             |

## 3. 画面仕様

### 3.1 SCR-200 タスク一覧

#### 3.1.1 画面要素

- 上部：ページタイトル「タスク」
- 右上：Primary「タスク作成」ボタン
- 一覧：テーブルまたはカード
  - 表示列（推奨順）
    - title
    - type
    - priority
    - estimate_minutes
    - due_at
    - status（open/done）
  - 行操作
    - 「詳細」遷移
    - 「完了/未完了」トグル（open/done）
    - 「編集」遷移

#### 3.1.2 初期表示

- status=archived は一覧に表示しない（フィルタ UI は MVP 対象外）
- 並び順（既定）
  - status=open を上位
  - due_at が近いものを上位（due_at=null は後）
  - priority が高いものを上位

#### 3.1.3 操作と API

| 操作       | トリガー        | API                            | 成功時                    | 失敗時               |
| ---------- | --------------- | ------------------------------ | ------------------------- | -------------------- |
| 一覧取得   | 画面表示        | GET /tasks                     | 一覧表示                  | 画面上部にエラー表示 |
| 作成へ遷移 | 作成ボタン      | -                              | SCR-202 へ                | -                    |
| 詳細へ遷移 | 行クリック/詳細 | -                              | SCR-201 へ                | -                    |
| 完了       | 完了ボタン      | POST /tasks/{task_id}/complete | トースト（I-xxxx）+再読込 | エラー表示           |
| 未完了     | 未完了ボタン    | POST /tasks/{task_id}/reopen   | トースト（I-xxxx）+再読込 | エラー表示           |

#### 3.1.4 UI 状態

- ローディング：スケルトン表示
- 空状態：空メッセージ＋「タスク作成」導線
- エラー：message_id に従い画面上部表示

---

### 3.2 SCR-201 タスク詳細

#### 3.2.1 表示項目

- Task の全項目（description/tags 含む）
- due_at / available_from / available_to は未設定の場合は「未設定」と表示

#### 3.2.2 操作と API

| 操作        | トリガー   | API                                       | 成功時          | 失敗時                            |
| ----------- | ---------- | ----------------------------------------- | --------------- | --------------------------------- |
| 取得        | 画面表示   | GET /tasks/{task_id}                      | 詳細表示        | 404 は「見つかりません」+一覧導線 |
| 編集へ遷移  | 編集ボタン | -                                         | SCR-203 へ      | -                                 |
| 完了/未完了 | ボタン     | POST /tasks/{task_id}/complete or /reopen | トースト+再取得 | エラー表示                        |

---

### 3.3 SCR-202 タスク作成

#### 3.3.1 入力項目

- Task 項目（status は作成時 open 固定）
- due*at / available*\* は日時ピッカーで入力
- splittable=false の場合、min_block_minutes は非活性

#### 3.3.2 画面操作

| 操作       | トリガー              | API         | 成功時                    | 失敗時                        |
| ---------- | --------------------- | ----------- | ------------------------- | ----------------------------- |
| 作成       | 保存ボタン（Primary） | POST /tasks | トースト + SCR-201 へ遷移 | field_errors を項目直下に表示 |
| キャンセル | 戻る（Secondary）     | -           | SCR-200 へ                | -                             |

---

### 3.4 SCR-203 タスク編集

#### 3.4.1 入力項目

- Task 項目（status 含む）
- status=archived は編集画面でのみ変更可能（open/done/archived）

#### 3.4.2 画面操作

| 操作     | トリガー              | API                     | 成功時                | 失敗時            |
| -------- | --------------------- | ----------------------- | --------------------- | ----------------- |
| 初期取得 | 画面表示              | GET /tasks/{task_id}    | フォーム初期化        | エラー表示        |
| 更新     | 保存ボタン（Primary） | PATCH /tasks/{task_id}  | トースト + SCR-201 へ | field_errors 表示 |
| 削除     | 削除ボタン（Danger）  | DELETE /tasks/{task_id} | トースト + SCR-200 へ | エラー表示        |

## 4. UI バリデーション（クライアント側）

- title：必須、1〜100 文字
- estimate_minutes：必須、5〜1440
- priority：必須、1〜5
- available_from と available_to：両方ある場合は available_from < available_to
- min_block_minutes：splittable=true の場合のみ、5〜180

## 5. UI エラー表示ルール

- 400：field_errors を項目直下、全体は画面上部
- 404：詳細/編集は一覧へ戻る導線を提示
- 500：画面上部に表示し再試行導線
