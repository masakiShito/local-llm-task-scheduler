# 詳細設計：エラー仕様 概要（MVP）

## 1. 本書の目的

本書は、本システムにおけるエラー・警告・通知の扱いを定義し、
API 実装・UI 表示・テスト観点を統一することを目的とする。

本仕様では、**message_id を中心とした制御**を行い、
文言・表示方法・重要度を分離する。

---

## 2. エラー設計の基本方針

- エラー・警告・通知はすべて message_id を持つ
- API は message_id を返却するのみで、表示判断は UI に委ねる
- エラーの有無で HTTP ステータスを使い分ける
- 業務的に「問題はあるが処理は成功」と判断できるものは warnings とする

---

## 3. 分類

| 種別    | 用途                   | HTTP      |
| ------- | ---------------------- | --------- |
| Info    | 成功通知・補足         | 200       |
| Warning | 注意喚起（処理は成功） | 200       |
| Error   | 処理失敗               | 4xx / 5xx |

---

## 4. message_id 命名規則

### 4.1 形式

- Info：I-XXXX
- Warning：W-XXXX
- Error：E-XXXX

### 4.2 採番ルール（MVP）

| 範囲         | 用途               |
| ------------ | ------------------ |
| I-0001〜0099 | Task 系            |
| I-0101〜0199 | Event 系           |
| I-0201〜0299 | Plan / Generate 系 |
| W-0200〜0299 | 計画生成警告       |
| E-0400〜0499 | 入力エラー         |
| E-0404       | リソース未存在     |
| E-0500〜0599 | サーバエラー       |

---

## 5. エラーレスポンス形式

### 5.1 Error（4xx / 5xx）

    error:
      message_id: E-0400
      message: 入力内容を確認してください
      field_errors:
        - field: title
          message_id: E-0400
          message: タイトルは必須です

### 5.2 field_errors ルール

- field はリクエスト JSON のキー名を指定する
- ネストはドット表記とする
- field_errors が存在する場合、message_id は E-0400 とする

---

## 6. Warning 仕様

### 6.1 warnings の返却位置

- warnings は成功レスポンス（200）の data 内に含める
- エラーとしては扱わない

  warnings: - message_id: W-0201
  message: 本日の空き時間に収まらないタスクがあります

### 6.2 Warning の扱い

- UI では「注意」として表示する
- 処理中断・画面遷移の阻害は行わない
- ユーザーが判断できる情報提供を目的とする

---

## 7. Info 仕様

### 7.1 Info の返却位置

- 成功時は meta.message_id として返却する

  meta:
  message_id: I-0001

### 7.2 UI での扱い

- トースト表示などの軽い通知に使用する
- 表示しない実装も許可する（UI 裁量）

---

## 8. HTTP ステータス別ルール

| ステータス | 扱い                 |
| ---------- | -------------------- |
| 200        | 成功（warning 含む） |
| 201        | 使用しない（MVP）    |
| 400        | 入力エラー           |
| 404        | 対象リソースなし     |
| 500        | サーバ内部エラー     |

---

## 9. 禁止事項

- message_id を持たないエラーを返却しない
- warning を 4xx / 5xx で返却しない
- 業務的エラー（overflow 等）を HTTP エラーにしない

---

## 10. 実装準拠事項

- message_id は固定値として扱い、意味を変更しない
- 文言変更が必要な場合は UI 側で対応する
- 新規 message_id 追加時は本設計書に追記する
