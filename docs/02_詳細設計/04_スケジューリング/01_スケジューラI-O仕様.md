# 詳細設計：スケジューラ I/O 仕様（MVP）

## 1. 本書の目的

スケジューラの入力データと出力データのスキーマを定義し、実装とテストの基準を統一する。

---

## 2. 入力

### 2.1 入力データ（概念）

- 対象日：date
- タイムゾーン：timezone
- 作業可能時間：working_hours（時刻のみ）
- 固定予定：events（datetime）
- 対象タスク：tasks（未完了のみ）
- 制約：constraints（break/focus/buffer）

### 2.2 入力スキーマ（例）

    date: 2026-01-11
    timezone: Asia/Tokyo

    working_hours:
      - start: "09:00"
        end: "12:00"
      - start: "13:00"
        end: "18:00"

    events:
      - event_id: uuid
        start_at: 2026-01-11T10:00:00+09:00
        end_at: 2026-01-11T11:00:00+09:00
        title: 会議

    tasks:
      - task_id: uuid
        title: 設計書作成
        status: open
        type: task
        priority: 5
        estimate_minutes: 120
        due_at: 2026-01-12T23:59:00+09:00
        available_from: null
        available_to: null
        splittable: true
        min_block_minutes: 30

    constraints:
      break_minutes: 10
      focus_max_minutes: 90
      buffer_ratio: 0.1

---

## 3. 出力

### 3.1 出力データ（概念）

- blocks：PlanBlock の配列（work/break/buffer）
- overflow：割当できなかったタスク配列
- warnings：注意情報配列

### 3.2 出力スキーマ（例）

    blocks:
      - start_at: 2026-01-11T09:00:00+09:00
        end_at: 2026-01-11T10:30:00+09:00
        kind: work
        task_id: uuid
        task_title: 設計書作成
        meta: {}

      - start_at: 2026-01-11T10:30:00+09:00
        end_at: 2026-01-11T10:40:00+09:00
        kind: break
        task_id: null
        task_title: null
        meta: {}

      - start_at: 2026-01-11T17:30:00+09:00
        end_at: 2026-01-11T18:00:00+09:00
        kind: buffer
        task_id: null
        task_title: null
        meta: {}

    overflow:
      - task_id: uuid
        task_title: 実装
        estimate_minutes: 120
        priority: 4
        due_at: 2026-01-12T12:00:00+09:00
        reason: not_enough_free_time

    warnings:
      - message_id: W-0201
        message: 本日の空き時間に収まらないタスクがあります

---

## 4. 正規化（入力の扱い）

- working_hours は start 昇順に並べ替えて扱う
- events は対象日と重なる部分のみを切り出して扱う
- tasks は status=open のみを対象とする
- available_from / available_to により対象日で実行不可のタスクは割当対象から除外し overflow に回す

---

## 5. 禁止事項

- LLM の出力で blocks の順序や割当を変更しない
- 乱数などにより結果が変動する実装を行わない
