# 基本設計書：非機能要件（最低限）※MVP

## 1. 本書の目的

本書は、本システムの MVP として最低限満たすべき非機能要件を定義し、
開発・テスト・運用における基準を統一することを目的とする。

---

## 2. 対象範囲

- 対象システム：タスク管理＋計画生成（MVP）
- 対象環境：ローカル開発（Docker）および個人利用を前提としたデプロイ

---

## 3. 性能（Performance）

### 3.1 想定データ量（MVP）

- tasks：最大 200 件（open + done + archived の合計）
- events：1 日あたり最大 50 件
- plan_blocks：1 日あたり最大 200 件

### 3.2 応答目標

- GET 系（/tasks, /events, /plans）：平均 500ms 以内
- POST /plans/generate：平均 3 秒 以内（LLM 説明生成を除く）
- POST /plans/generate：平均 8 秒 以内（LLM 説明生成を含む）

### 3.3 タイムアウト

- API タイムアウト：30 秒
- LLM 説明生成：20 秒で打ち切り、計画生成は成功として返却する

---

## 4. 可用性（Availability）

- LLM が利用できない場合でも、計画生成（Plan/PlanBlock の保存）は必ず実施する
- DB 接続不可など致命障害時は 500 を返却し、UI は再試行導線を表示する

---

## 5. 信頼性（Reliability）

- 計画（Plan）は生成ごとに必ず保存し、再現性を確保する
- 生成パラメータ（Plan.params）は必ず保存する
- 生成処理の途中失敗で不整合が発生しないよう、Plan/PlanBlock 作成はトランザクションで扱う

---

## 6. セキュリティ（Security）

- MVP は単一ユーザー前提とし、認証・認可は実装しない
- 外部公開する場合は、認証導入を前提とする（Phase2）
- 入力は全てサーバ側でバリデーションし、不正値を保存しない

---

## 7. ログ（Logging）

- 生成系ログ（必須）
  - 計画生成開始（date, params 概要）
  - 計画生成完了（plan_id, block 数, overflow 数, warnings 数, 処理時間）
  - LLM 説明生成失敗（plan_id, エラー概要）
- CRUD 系ログ（任意）
  - 作成/更新/削除のイベントログ（ID のみ）

---

## 8. 監視（Monitoring）※MVP

- ヘルスチェック：GET /health を提供する
- ローカル運用ではアプリログの確認を一次手段とする

---

## 9. 運用・保守（Operations）

- DB マイグレーションを実施可能な構成とする（例：Alembic）
- 破壊的変更を避けるため、API レスポンスは後方互換を意識する

---

## 10. 次工程への引き渡し

- 詳細設計（API 設計）でタイムアウト・エラー形式を反映する
- 実装ではトランザクション制御と LLM タイムアウトを必須要件として担保する
- テストでは性能目標を計測し、/plans/generate の LLM 失敗時の継続を必須観点とする
