# 基本設計書：生成パラメータ仕様（標準値・範囲）※MVP

## 1. 本書の目的

本書は、計画生成（POST /plans/generate）で使用する生成パラメータの標準値・入力範囲・整合性ルールを定義し、
画面実装・API 実装・テスト実装の基準を統一することを目的とする。

---

## 2. 対象範囲

- 対象 API：POST /plans/generate
- 対象画面：SCR-401（計画生成）
- 対象データ：Plan.params（生成条件の保存）

---

## 3. 生成パラメータ一覧（MVP）

| パラメータ名      | 型     | 単位 | 必須 |     標準値 | 最小 | 最大 | 説明                              |
| ----------------- | ------ | ---: | ---- | ---------: | ---: | ---: | --------------------------------- |
| date              | date   |    - | 必須 |          - |    - |    - | 計画対象日                        |
| timezone          | string |    - | 必須 | Asia/Tokyo |    - |    - | タイムゾーン                      |
| working_hours     | array  |    - | 必須 |          - | 1 件 | 3 件 | 作業可能時間帯（開始/終了のペア） |
| break_minutes     | int    |   分 | 任意 |         10 |    0 |   30 | 休憩ブロックの長さ                |
| focus_max_minutes | int    |   分 | 任意 |         90 |   30 |  180 | 連続作業の上限                    |
| buffer_ratio      | number | 比率 | 任意 |       0.10 | 0.00 | 0.30 | バッファ確保比率                  |
| min_block_minutes | int    |   分 | 任意 |         25 |    5 |   60 | 分割可能タスクの最小ブロック長    |
| allow_split       | bool   |    - | 任意 |       true |    - |    - | 分割可能タスクの分割を許可するか  |

補足：

- min_block_minutes / allow_split は「タスク個別設定」がある場合でも、生成側の上限ルールとして適用する
- working_hours の件数上限は MVP での UI 簡略化のために 3 件とする

---

## 4. working_hours 仕様

### 4.1 データ形式

- working_hours は以下の要素の配列とする
  - start：時刻（HH:MM）
  - end：時刻（HH:MM）

### 4.2 入力ルール

- start < end を満たす
- 同一日の時刻として解釈する
- 各要素は重複・交差しない（隣接は許可）
- 配列は時刻昇順に正規化して保存する

---

## 5. 整合性ルール（MVP）

### 5.1 分割と最小ブロック

- allow_split = false の場合、分割可能タスクも分割しない
- allow_split = true の場合、分割可能タスクは min_block_minutes 単位で分割可能
- min_block_minutes は focus_max_minutes を超えない（超える場合は入力不正）

### 5.2 休憩挿入

- focus_max_minutes を超える連続作業を割り当てる場合、休憩ブロック（break_minutes）を挿入する
- break_minutes = 0 の場合、休憩ブロックは挿入しない

### 5.3 バッファ確保

- buffer_ratio に基づき、作業可能時間合計からバッファ時間を算出する
- 算出されたバッファ時間は plan_blocks として buffer を末尾に配置する
- バッファ時間が min_block_minutes 未満の場合、buffer ブロックは作成しない

---

## 6. 画面表示・入力仕様（要点）

- SCR-401 は標準値を初期表示する
- 入力範囲外は即時エラー表示する
- working_hours は追加・削除可能とする（1〜3 件）

---

## 7. 次工程への引き渡し

- 詳細設計（API 設計）で request/response スキーマに反映する
- バリデーション実装は本仕様の最小/最大/整合性ルールを満たす
- テストでは境界値（min/max）および交差・不整合パターンを必須観点とする
