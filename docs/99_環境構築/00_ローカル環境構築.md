# ローカル環境構築メモ（FastAPI API）

## 前提

- Python 3.11 以上
- この API は **インメモリ実装** です（サーバ再起動でデータは消えます）

---

## 1. リポジトリのセットアップ

```bash
git clone <repository-url>
cd local-llm-task-scheduler
```

---

## 2. Docker でローカル起動（推奨）

### 2.1 起動

```bash
docker compose up --build
```

- API: http://localhost:8000
- フロント: http://localhost:3000
- DB: localhost:5432（PostgreSQL）

### 2.2 停止

```bash
docker compose down
```

---

## 3. Apple シリコン（M1/M2/M3）の注意点

Apple シリコン環境では、Docker Desktop の `Use Rosetta for x86/amd64 emulation` を無効にして問題ありません。  
PostgreSQL は `postgres:16-alpine` の arm64 イメージが利用されます。

---

## 4. Python ローカル起動（任意）

Docker を使わない場合のみ実施します。

### 4.1 Python 仮想環境の作成

```bash
python -m venv .venv
source .venv/bin/activate
```

### 4.2 依存関係のインストール

```bash
pip install -r requirements.txt
```

### 4.3 API 起動

```bash
uvicorn apps.api.main:app --reload --port 8000
```

起動後、以下で疎通確認できます。

```bash
curl http://127.0.0.1:8000/tasks
```

---

## 5. 動作確認（例）

### 5.1 タスク作成

```bash
curl -X POST http://127.0.0.1:8000/tasks \
  -H "Content-Type: application/json" \
  -d '{
    "title": "設計書作成",
    "description": "API設計を行う",
    "type": "task",
    "priority": 5,
    "estimate_minutes": 120,
    "due_at": "2026-01-12T23:59:00+09:00",
    "splittable": true,
    "min_block_minutes": 30,
    "tags": ["design"]
  }'
```

### 5.2 固定予定作成

```bash
curl -X POST http://127.0.0.1:8000/events \
  -H "Content-Type: application/json" \
  -d '{
    "title": "会議",
    "start_at": "2026-01-11T10:00:00+09:00",
    "end_at": "2026-01-11T11:00:00+09:00",
    "description": "定例MTG"
  }'
```

### 5.3 計画生成

```bash
curl -X POST http://127.0.0.1:8000/plans/generate \
  -H "Content-Type: application/json" \
  -d '{
    "date": "2026-01-11",
    "timezone": "Asia/Tokyo",
    "working_hours": [
      { "start": "09:00", "end": "12:00" },
      { "start": "13:00", "end": "18:00" }
    ],
    "constraints": {
      "break_minutes": 10,
      "focus_max_minutes": 90,
      "buffer_ratio": 0.1
    }
  }'
```

---

## 6. 補足

- API は設計書のレスポンス形式（`data` / `meta`）に準拠しています。
- 本実装は **MVP 段階の簡易スケジューラ** です。
